---
export interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  image?: string;
  imageAlt?: string;
  type?: 'website' | 'article';
  publishedTime?: Date;
  modifiedTime?: Date;
  author?: string;
  tags?: string[];
  // Ayodesk-inspired social metadata overrides
  og_title?: string;
  og_description?: string;
  twitter_title?: string;
  twitter_description?: string;
  // SEO metadata (ayodesk-inspired)
  keywords?: string;
  robots?: string;
}

const {
  title = 'AICW - The AI Visibility Toolkit for Websites',
  description = 'Audit your AI accessibility, track visitors from ChatGPT, Claude, and Perplexity, and see where your brand ranks in AI answers. Privacy-first analytics with no cookies. Create your free account today.',
  canonical = Astro.url.pathname,
  image,
  imageAlt = 'AI Chat Watch - AI Visibility Monitoring Tool',
  type = 'website',
  publishedTime,
  modifiedTime,
  author,
  tags = [],
  og_title,
  og_description,
  twitter_title,
  twitter_description,
  keywords,
  robots = 'index, follow',
} = Astro.props;

// Generate dynamic OG image path from canonical URL
// e.g., /blog/my-post/ â†’ /assets/og-img/blog/my-post.png
function generateOgImagePath(path: string): string | null {
  // Remove leading/trailing slashes and split
  const cleanPath = path.replace(/^\/|\/$/g, '');
  const parts = cleanPath.split('/');

  // Check if this is a content page with collection/slug pattern
  const collections = ['blog', 'ai-search-engine', 'ai-crawler-bot', 'ai-chat-bot'];
  if (parts.length >= 2 && collections.includes(parts[0])) {
    const collection = parts[0];
    const slug = parts.slice(1).join('/');
    return `/assets/og-img/${collection}/${slug}.png`;
  }

  return null;
}

// Determine OG image: custom image > dynamic OG > default fallback
const defaultImage = '/assets/images/aicw-social-preview.png';
const dynamicOgImage = generateOgImagePath(canonical);
const resolvedImage = image || (dynamicOgImage || defaultImage);

// Use custom social metadata or fall back to defaults
const ogTitle = og_title || title;
const ogDescription = og_description || description;
const twitterTitle = twitter_title || title;
const twitterDescription = twitter_description || description;

const siteUrl = 'https://www.aicw.io';
const fullCanonical = new URL(canonical, siteUrl).href;
const fullImage = new URL(resolvedImage, siteUrl).href;
---

<!-- Primary Meta Tags -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{title}</title>
<meta name="description" content={description}>
{keywords && <meta name="keywords" content={keywords}>}
<meta name="robots" content={robots}>
<meta name="author" content={author || 'AI Chat Watch'}>
<link rel="canonical" href={fullCanonical}>

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type}>
<meta property="og:url" content={fullCanonical}>
<meta property="og:title" content={ogTitle}>
<meta property="og:description" content={ogDescription}>
<meta property="og:image" content={fullImage}>
<meta property="og:image:alt" content={imageAlt}>
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="AI Chat Watch">

{type === 'article' && publishedTime && (
  <>
    <meta property="article:published_time" content={publishedTime.toISOString()}>
    {modifiedTime && <meta property="article:modified_time" content={modifiedTime.toISOString()}>}
    {author && <meta property="article:author" content={author}>}
    {tags.map(tag => <meta property="article:tag" content={tag}>)}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content={fullCanonical}>
<meta name="twitter:title" content={twitterTitle}>
<meta name="twitter:description" content={twitterDescription}>
<meta name="twitter:image" content={fullImage}>
<meta name="twitter:image:alt" content={imageAlt}>

<!-- Favicons -->
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="AIChatWatch" />
<link rel="manifest" href="/site.webmanifest" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

<!-- Sitemap -->
<link rel="sitemap" href="/sitemap-index.xml" />
